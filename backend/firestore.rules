rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    match /articles/{articleId} {
      
      // Public Access Rules for News App
      
      // Read: Open access (Standard for News Delivery)
      allow read: if true;
      
      // Write: Enabled for development/testing environments
      allow write: if true;

      function isValidArticle(data) {
        return
          // Campos obligatorios básicos
          data.keys().hasAll([
            'title',
            'description',
            'content',
            'author',
            'isPublished',
            'publishedAt',
            'thumbnailUrl'  // Cambió de thumbnailURL a thumbnailUrl
          ]) &&

          // Tipos de datos obligatorios
          data.title is string &&
          data.description is string &&
          data.content is string &&
          data.author is string &&
          data.isPublished is bool &&
          data.publishedAt is timestamp &&
          data.thumbnailUrl is string &&

          // Campos opcionales (si existen, validar tipo)
          (!('url' in data) || data.url is string) &&
          (!('isVisibleToPublic' in data) || data.isVisibleToPublic is bool);
      }
    }
  }
}