rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
  match /articles/{articleId} {
    // Lectura pública solo de artículos publicados
  allow read: if resource.data.isPublished == true;

  // Escritura solo para usuarios autenticados y con estructura válida
  allow create, update, delete: if request.auth != null
    && isValidArticle(request.resource.data);

  function isValidArticle(data) {
    return
      // Campos obligatorios
      data.keys().hasAll([
        'title',
        'description',
        'content',
        'author',
        'isPublished',
        'publishedAt',
        'createdAt',
        'updatedAt',
        'thumbnailURL'
      ]) &&

      // Tipos de datos obligatorios
      data.title is string &&
      data.description is string &&
      data.content is string &&
      data.author is string &&
      data.isPublished is bool &&
      data.publishedAt is timestamp &&
      data.createdAt is timestamp &&
      data.updatedAt is timestamp &&
      data.thumbnailURL is string &&

      // Campos opcionales (si existen, validar tipo)
      (!('id' in data) || data.id is number) &&
      (!('url' in data) || data.url is string) &&
      (!('source' in data) || data.source is string);
  }
  }
  }
}